<!DOCTYPE html>
<html>
<head>
    <title>Table Background Test</title>
    <script src="https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        button {
            margin: 10px;
            padding: 10px;
            background: #0078d4;
            color: white;
            border: none;
            cursor: pointer;
        }
        #status {
            margin-top: 20px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h2>Table Background Color Test</h2>
    
    <button onclick="insertTable()">Insert Table</button>
    <button onclick="setBackgroundRed()">Set Background Red</button>
    <button onclick="setBackgroundTransparent()">Set Background Transparent</button>
    <button onclick="checkBackground()">Check Current Background</button>
    
    <div id="status">Ready</div>
    
    <script>
        let tableRef = null;
        
        Office.initialize = function() {
            document.getElementById('status').innerText = 'Office initialized';
        };
        
        async function insertTable() {
            try {
                await Word.run(async (context) => {
                    const selection = context.document.getSelection();
                    const table = selection.insertTable(3, 3, Word.InsertLocation.after);
                    
                    // Load and sync
                    context.load(table);
                    await context.sync();
                    
                    // Store reference
                    tableRef = table;
                    
                    document.getElementById('status').innerText = 'Table inserted successfully';
                });
            } catch (error) {
                document.getElementById('status').innerText = 'Error: ' + error.message;
            }
        }
        
        async function setBackgroundRed() {
            try {
                await Word.run(async (context) => {
                    const tables = context.document.body.tables;
                    context.load(tables, 'items');
                    await context.sync();
                    
                    if (tables.items.length === 0) {
                        document.getElementById('status').innerText = 'No tables found';
                        return;
                    }
                    
                    const table = tables.items[0];
                    context.load(table.rows, 'items');
                    await context.sync();
                    
                    // Load cells for each row
                    for (const row of table.rows.items) {
                        context.load(row.cells, 'items');
                    }
                    await context.sync();
                    
                    // Set background color for each cell
                    let cellCount = 0;
                    for (const row of table.rows.items) {
                        for (const cell of row.cells.items) {
                            // Load the cell's properties
                            context.load(cell, ['shadingColor']);
                            await context.sync();
                            
                            // Set the shading color
                            cell.shadingColor = '#FF0000';
                            cellCount++;
                        }
                    }
                    
                    // Final sync
                    await context.sync();
                    
                    document.getElementById('status').innerText = `Set ${cellCount} cells to red background`;
                });
            } catch (error) {
                document.getElementById('status').innerText = 'Error: ' + error.message;
            }
        }
        
        async function setBackgroundTransparent() {
            try {
                await Word.run(async (context) => {
                    const tables = context.document.body.tables;
                    context.load(tables, 'items');
                    await context.sync();
                    
                    if (tables.items.length === 0) {
                        document.getElementById('status').innerText = 'No tables found';
                        return;
                    }
                    
                    const table = tables.items[0];
                    context.load(table.rows, 'items');
                    await context.sync();
                    
                    // Load cells for each row
                    for (const row of table.rows.items) {
                        context.load(row.cells, 'items');
                    }
                    await context.sync();
                    
                    // Set background color for each cell
                    let cellCount = 0;
                    for (const row of table.rows.items) {
                        for (const cell of row.cells.items) {
                            // Try different approaches
                            cell.shadingColor = null; // Try null for transparent
                            cellCount++;
                        }
                    }
                    
                    // Final sync
                    await context.sync();
                    
                    document.getElementById('status').innerText = `Set ${cellCount} cells to transparent background`;
                });
            } catch (error) {
                document.getElementById('status').innerText = 'Error: ' + error.message;
            }
        }
        
        async function checkBackground() {
            try {
                await Word.run(async (context) => {
                    const tables = context.document.body.tables;
                    context.load(tables, 'items');
                    await context.sync();
                    
                    if (tables.items.length === 0) {
                        document.getElementById('status').innerText = 'No tables found';
                        return;
                    }
                    
                    const table = tables.items[0];
                    context.load(table.rows, 'items');
                    await context.sync();
                    
                    // Load cells for first row
                    const firstRow = table.rows.items[0];
                    context.load(firstRow.cells, 'items');
                    await context.sync();
                    
                    // Check first cell
                    const firstCell = firstRow.cells.items[0];
                    context.load(firstCell, ['shadingColor']);
                    await context.sync();
                    
                    document.getElementById('status').innerText = `First cell background: ${firstCell.shadingColor}`;
                });
            } catch (error) {
                document.getElementById('status').innerText = 'Error: ' + error.message;
            }
        }
    </script>
</body>
</html>